# 機能仕様書

## 1. システム概要

玄関の2つの鍵（本錠・バー錠）の施錠状況をチェックし、履歴をカレンダー形式で管理するシングルページアプリケーション。手間ゼロでの操作を最重視し、スマートフォンでの利用に最適化されている。

## 2. 機能一覧

### 2.1 コア機能
1. **今日のチェック機能** - 本日の施錠状況確認・記録
2. **カレンダービュー機能** - 過去の施錠履歴表示
3. **詳細モーダル機能** - 日別の詳細情報表示

### 2.2 サポート機能
1. **設定機能** - テーマ切替・データ初期化
2. **データ管理機能** - ローカルストレージ操作
3. **ナビゲーション機能** - 画面間遷移

## 3. 機能詳細

### 3.1 今日のチェック機能
- **概要**: 当日の本錠・バー錠の施錠状況をチェック・記録
- **入力**: 
  - 本錠トグルボタン（🔒⇄🔓）
  - バー錠トグルボタン（🔒⇄🔓）
  - 保存ボタン
- **処理**: 
  1. 現在日時を自動取得
  2. トグル状態を内部ステートで管理
  3. 両方ロック状態時のみ保存ボタン有効化
  4. 保存時にlocalStorageへデータ永続化
- **出力**: 
  - 保存完了メッセージ
  - 視覚的フィードバック（アイコン変化）
- **制約**: 
  - 日付は当日固定（変更不可）
  - 両方ロック状態でないと保存不可
- **エラーハンドリング**: 
  - localStorage保存失敗時のアラート表示
  - 不正な状態での保存試行時の警告

### 3.2 カレンダービュー機能
- **概要**: 過去3ヵ月分の施錠履歴をカレンダー形式で表示
- **入力**: 
  - 月移動ボタン（前月・次月）
  - 日付セルタップ
- **処理**: 
  1. localStorageから履歴データ取得
  2. 月ごとのカレンダーグリッド生成
  3. 各日の施錠状況に応じたアイコン表示
  4. 3ヵ月範囲での月移動制御
- **出力**: 
  - 月次カレンダーグリッド
  - 日別状態アイコン（✅／⚠️）
  - 月移動ナビゲーション
- **制約**: 
  - 表示期間は過去3ヵ月まで
  - 未来日は表示しない
- **エラーハンドリング**: 
  - データ取得失敗時のデフォルト表示
  - 不正な日付での処理エラー防止

### 3.3 詳細モーダル機能
- **概要**: 選択した日の詳細情報をモーダル表示
- **入力**: 
  - 日付セルタップ
  - モーダル閉じるボタン
- **処理**: 
  1. 選択日のデータ検索
  2. タイムスタンプ・ユーザー情報整形
  3. モーダル表示・非表示制御
- **出力**: 
  - 施錠詳細情報
  - タイムスタンプ
  - 操作者情報
- **制約**: 
  - データが存在する日のみ詳細表示
- **エラーハンドリング**: 
  - データ不存在時の適切なメッセージ表示

### 3.4 設定機能
- **概要**: アプリケーションの基本設定管理
- **入力**: 
  - テーマ切替ボタン
  - データ初期化ボタン
- **処理**: 
  1. テーマ設定のlocalStorage保存
  2. データ初期化の確認ダイアログ表示
  3. 全データ削除処理
- **出力**: 
  - テーマ適用
  - 初期化完了メッセージ
- **制約**: 
  - データ初期化は2段階確認必須
- **エラーハンドリング**: 
  - 設定保存失敗時の復旧処理

## 4. データ仕様

### 4.1 データ構造
```javascript
// メインデータ構造
{
  version: "1.0",
  settings: {
    theme: "light" | "dark",
    lastUsed: "ISO8601文字列"
  },
  records: [
    {
      date: "YYYY-MM-DD",
      mainLock: boolean,
      barLock: boolean,
      timestamp: "ISO8601文字列",
      user: "user1" | "user2"
    }
  ]
}
```

### 4.2 データフロー
1. **書き込み**: UI操作 → State更新 → localStorage保存
2. **読み込み**: localStorage取得 → パース → State設定 → UI更新
3. **初期化**: デフォルトデータ生成 → localStorage保存

## 5. インターフェース仕様

### 5.1 UI仕様

#### メイン画面
- **ヘッダー**: アプリタイトル・ナビゲーション
- **日付表示**: 当日日付（自動更新）
- **施錠チェック**: 2つのトグルボタン
- **保存ボタン**: 両方ロック時のみ有効

#### カレンダー画面
- **月ナビゲーション**: 前月・次月ボタン
- **カレンダーグリッド**: 7×6のグリッドレイアウト
- **状態表示**: 各セルにアイコン表示

#### 設定画面
- **テーマ切替**: ライト・ダークの切替
- **データ管理**: 初期化ボタン

### 5.2 レスポンシブ対応
- **スマートフォン**: 縦向き最適化（主要対象）
- **タブレット**: 横向き対応
- **PC**: デスクトップでも操作可能

## 6. セキュリティ仕様

### 6.1 データ保護
- **ローカル保存**: 外部送信一切なし
- **入力検証**: XSS対策のサニタイゼーション
- **権限**: ブラウザの同一オリジンポリシーに依存

### 6.2 プライバシー
- **個人情報**: 収集しない
- **追跡**: アナリティクス不使用
- **Cookie**: 使用しない

## 7. エラー処理

### 7.1 エラー分類
- **レベル1（軽微）**: 操作ガイダンス表示
- **レベル2（重要）**: アラート表示・処理中断
- **レベル3（致命的）**: アプリケーション再初期化

### 7.2 具体的なエラーハンドリング

#### localStorage関連
```javascript
try {
  localStorage.setItem(key, data);
} catch (error) {
  console.error('保存に失敗しました:', error);
  alert('データの保存に失敗しました。ブラウザの容量を確認してください。');
}
```

#### データパース関連
```javascript
try {
  const data = JSON.parse(stored);
  return data;
} catch (error) {
  console.error('データ形式が不正です:', error);
  return getDefaultData();
}
```

### 7.3 ユーザビリティ考慮
- **エラーメッセージ**: 分かりやすい日本語表示
- **復旧手順**: 具体的な対処方法を提示
- **データ保護**: 可能な限りデータ消失を防ぐ